<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>KaKaReza Black Jack</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      background: #232526;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      min-height: 100vh;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
    }
    h1 {
      text-align: center;
      font-size: 2.1em;
      margin: 16px 0 4px 0;
      color: #ffd600;
      font-weight: bold;
      letter-spacing: 2px;
      text-shadow: 1px 1px 6px #000;
    }
    #game-area {
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: stretch;
      min-height: 0;
      padding: 0;
      background: #232526;
    }
    .section-title {
      text-align: center;
      font-size: 1.1em;
      margin: 8px 0 0 0;
      color: #ffd600;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .cards-area {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      min-height: 210px;
      margin: 0 0 0 0;
      position: relative;
      z-index: 2;
    }
    .hand {
      display: flex;
      align-items: center;
      margin: 0 8px;
      position: relative;
    }
    .card {
      width: 120px;
      height: 176px;
      margin-left: -44px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 2px 12px #000a;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3.8em;
      font-weight: bold;
      color: #333;
      border: 3px solid #333;
      position: relative;
      z-index: 1;
      transition: transform 0.5s cubic-bezier(.4,1.5,.6,1), opacity 0.2s;
      opacity: 1;
    }
    .card.suit-hearts, .card.suit-diamonds { color: #e53935; }
    .card.suit-spades, .card.suit-clubs { color: #222; }
    .card.back {
      background: linear-gradient(135deg, #7c4dff 60%, #ff4081 100%);
      color: transparent;
      border: 3px solid #fff;
    }
    .card.deal-anim {
      transform: translateX(-120px);
      opacity: 0.2;
    }
    .hand-value {
      position: absolute;
      top: -24px;
      left: 0;
      width: 100%;
      text-align: left;
      font-size: 1.2em;
      color: #ffd600;
      font-weight: bold;
      text-shadow: 1px 1px 3px #000;
    }
    #player-chips {
      font-size: 1.3em;
      color: #fffde7;
      margin: 16px 0 0 0;
      text-align: center;
      font-weight: bold;
      letter-spacing: 1px;
    }
    #actions {
      display: flex;
      justify-content: center;
      margin: 12px 0 0 0;
      flex-wrap: wrap;
      gap: 10px;
    }
    #actions button {
      font-size: 1.2em;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      padding: 16px 30px;
      margin: 0 4px;
      min-width: 120px;
      box-shadow: 0 2px 8px #0004;
      transition: background 0.2s, transform 0.1s, color 0.2s;
      cursor: pointer;
      color: #fff;
    }
    #actions .hit-btn { background: #1abc3c; }
    #actions .stand-btn { background: #1976d2; }
    #actions .double-btn { background: #ff9800; }
    #actions .split-btn { background: #8e24aa; }
    #actions button:disabled {
      background: #888;
      cursor: not-allowed;
      color: #eee;
    }
    #status-message {
      text-align: center;
      font-size: 1.1em;
      min-height: 28px;
      margin: 14px 0 0 0;
      color: #ffd600;
      text-shadow: 1px 1px 4px #000;
      font-weight: bold;
    }
    #bottom-controls {
      width: 100vw;
      max-width: 100vw;
      background: #232526;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: sticky;
      bottom: 0;
      left: 0;
      z-index: 20;
      padding-bottom: env(safe-area-inset-bottom, 8px);
      box-sizing: border-box;
    }
    #chips {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 0 4px 0;
      flex-wrap: wrap;
      gap: 14px;
    }
    .chip {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: 4px solid #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      font-weight: bold;
      box-shadow: 0 2px 12px #000a;
      cursor: pointer;
      transition: transform 0.1s;
      user-select: none;
      margin-bottom: 4px;
    }
    .chip:active {
      transform: scale(1.08);
    }
    .chip10 { background: radial-gradient(circle, #ff5252 60%, #d32f2f 100%); color: #fff;}
    .chip20 { background: radial-gradient(circle, #ffb300 60%, #ff6f00 100%); color: #fff;}
    .chip50 { background: radial-gradient(circle, #4caf50 60%, #1b5e20 100%); color: #fff;}
    .chip100 { background: radial-gradient(circle, #2196f3 60%, #0d47a1 100%); color: #fff;}
    #bet-info {
      text-align: center;
      font-size: 1.1em;
      margin: 4px 0 0 0;
      color: #ffe082;
      font-weight: bold;
      letter-spacing: 1px;
    }
    #bet-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 4px 0 0 0;
      gap: 8px;
    }
    #bet-controls button, #next-hand-btn {
      background: #333;
      color: #fff;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      margin: 0 2px;
      padding: 12px 18px;
      cursor: pointer;
      box-shadow: 0 2px 8px #0008;
      transition: background 0.2s, transform 0.1s;
    }
    #bet-controls button:disabled, #next-hand-btn:disabled {
      background: #888;
      cursor: not-allowed;
    }
    #next-hand-btn {
      background: #ffd600;
      color: #222;
      font-size: 1.1em;
      margin-top: 6px;
      min-width: 120px;
      font-weight: bold;
    }
    .win-anim {
      animation: winFlash 0.7s alternate 3;
    }
    @keyframes winFlash {
      0% { color: #ffeb3b; text-shadow: 0 0 24px #fff; }
      100% { color: #00e676; text-shadow: 0 0 40px #00e676; }
    }
    @media (max-width: 600px) {
      #game-area { padding: 0; }
      .card { width: 80px; height: 116px; font-size: 2.2em; margin-left: -28px; }
      .chip { width: 40px; height: 40px; font-size: 1em; }
      #actions button, #bet-controls button, #next-hand-btn { font-size: 0.9em; padding: 8px 10px; min-width: 70px;}
      #player-chips, #status-message, #bet-info { font-size: 1em; }
      .section-title { font-size: 1em; }
      #bottom-controls { padding-bottom: env(safe-area-inset-bottom, 4px);}
    }
  </style>
</head>
<body>
  <h1>KaKaReza Black Jack</h1>
  <div id="game-area">
    <div class="section-title">Dealer</div>
    <div class="cards-area" id="dealer-cards"></div>
    <div class="section-title">Player</div>
    <div class="cards-area" id="player-cards"></div>
    <div id="player-chips">Your Chips: <span id="chips-total">5000</span></div>
    <div id="actions"></div>
    <div id="status-message"></div>
  </div>
  <div id="bottom-controls">
    <div id="chips">
      <div class="chip chip10" data-value="10">10</div>
      <div class="chip chip20" data-value="20">20</div>
      <div class="chip chip50" data-value="50">50</div>
      <div class="chip chip100" data-value="100">100</div>
    </div>
    <div id="bet-info">Place your bet (Min: 20)</div>
    <div id="bet-controls">
      <button id="clear-bet">Clear Bet</button>
      <button id="redo-bet">Redo Bet</button>
      <button id="deal-btn">Deal</button>
    </div>
    <button id="next-hand-btn" style="display:none;">Next Hand</button>
  </div>
  <script>
    // Suits and values
    const SUITS = ['hearts', 'diamonds', 'spades', 'clubs'];
    const VALUES = [
      {name: 'A', value: 11},
      {name: '2', value: 2},
      {name: '3', value: 3},
      {name: '4', value: 4},
      {name: '5', value: 5},
      {name: '6', value: 6},
      {name: '7', value: 7},
      {name: '8', value: 8},
      {name: '9', value: 9},
      {name: '10', value: 10},
      {name: 'J', value: 10},
      {name: 'Q', value: 10},
      {name: 'K', value: 10}
    ];

    // Game state
    let playerChips = 5000;
    let bet = 0;
    let lastBet = 0;
    let deck = [];
    let playerHands = [];
    let currentHandIdx = 0;
    let dealerHand = [];
    let inPlay = false;
    let canSplit = false;
    let canDouble = false;
    let splitActive = false;
    let playerBlackjack = false;
    let dealerBlackjack = false;
    let handResults = [];
    let animTimeouts = [];
    let waitingNextHand = false;

    // DOM
    const chipsTotal = document.getElementById('chips-total');
    const chipsArea = document.getElementById('chips');
    const betInfo = document.getElementById('bet-info');
    const clearBetBtn = document.getElementById('clear-bet');
    const redoBetBtn = document.getElementById('redo-bet');
    const dealBtn = document.getElementById('deal-btn');
    const dealerCards = document.getElementById('dealer-cards');
    const playerCards = document.getElementById('player-cards');
    const actionsArea = document.getElementById('actions');
    const statusMsg = document.getElementById('status-message');
    const nextHandBtn = document.getElementById('next-hand-btn');
    const playerChipsDiv = document.getElementById('player-chips');

    // Utility functions
    function buildDeck() {
      let d = [];
      for (let n = 0; n < 8; n++) {
        for (const s of SUITS) {
          for (const v of VALUES) {
            d.push({suit: s, name: v.name, value: v.value});
          }
        }
      }
      // Shuffle
      for (let i = d.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [d[i], d[j]] = [d[j], d[i]];
      }
      return d;
    }

    function handValue(hand) {
      let total = 0, aces = 0;
      for (const card of hand) {
        total += card.value;
        if (card.name === 'A') aces++;
      }
      while (total > 21 && aces > 0) {
        total -= 10;
        aces--;
      }
      return total;
    }

    function isBlackjack(hand) {
      return hand.length === 2 && handValue(hand) === 21;
    }

    function isPair(hand) {
      return hand.length === 2 && hand[0].name === hand[1].name;
    }

    function canSplitHand(hand) {
      return isPair(hand) && playerChips >= bet && playerHands.length < 2;
    }

    function canDoubleDown(hand) {
      return hand.length === 2 && playerChips >= bet;
    }

    function resetGame() {
      clearTimeouts();
      bet = 0;
      playerHands = [];
      currentHandIdx = 0;
      dealerHand = [];
      inPlay = false;
      canSplit = false;
      canDouble = false;
      splitActive = false;
      playerBlackjack = false;
      dealerBlackjack = false;
      handResults = [];
      waitingNextHand = false;
      updateChips();
      updateBetInfo();
      renderHands();
      renderActions();
      statusMsg.textContent = '';
      nextHandBtn.style.display = 'none';
      enableBetting(true);
    }

    function clearTimeouts() {
      for (const t of animTimeouts) clearTimeout(t);
      animTimeouts = [];
    }

    function updateChips() {
      chipsTotal.textContent = playerChips;
    }

    function updateBetInfo() {
      betInfo.textContent = bet > 0 ? `Current Bet: ${bet}` : 'Place your bet (Min: 20)';
    }

    function renderHands(showDealerHole = false, anim = false) {
      // Dealer
      dealerCards.innerHTML = '';
      dealerHand.forEach((card, idx) => {
        let cardDiv = document.createElement('div');
        cardDiv.className = 'card suit-' + card.suit;
        if (idx === 1 && !showDealerHole && inPlay) cardDiv.classList.add('back');
        else cardDiv.innerHTML = getCardSymbol(card);
        if (anim) {
          cardDiv.classList.add('deal-anim');
          setTimeout(() => cardDiv.classList.remove('deal-anim'), 80 + idx * 120);
        }
        dealerCards.appendChild(cardDiv);
      });
      // Dealer value
      let dealerVal = document.createElement('div');
      dealerVal.className = 'hand-value';
      dealerVal.textContent = showDealerHole || !inPlay ? `Value: ${handValue(dealerHand)}` : '';
      dealerCards.appendChild(dealerVal);

      // Player
      playerCards.innerHTML = '';
      playerHands.forEach((hand, hIdx) => {
        let handDiv = document.createElement('div');
        handDiv.className = 'hand';
        if (playerHands.length > 1 && hIdx === currentHandIdx) {
          handDiv.style.boxShadow = '0 0 18px #ffd600b0';
        }
        hand.forEach((card, idx) => {
          let cardDiv = document.createElement('div');
          cardDiv.className = 'card suit-' + card.suit;
          cardDiv.innerHTML = getCardSymbol(card);
          if (anim) {
            cardDiv.classList.add('deal-anim');
            setTimeout(() => cardDiv.classList.remove('deal-anim'), 160 + idx * 120);
          }
          handDiv.appendChild(cardDiv);
        });
        let valDiv = document.createElement('div');
        valDiv.className = 'hand-value';
        valDiv.textContent = `Value: ${handValue(hand)}`;
        handDiv.appendChild(valDiv);
        playerCards.appendChild(handDiv);
      });
    }

    function renderActions() {
      actionsArea.innerHTML = '';
      if (!inPlay) return;
      let hand = playerHands[currentHandIdx];
      // Hit
      let hitBtn = document.createElement('button');
      hitBtn.textContent = 'Hit';
      hitBtn.className = 'hit-btn';
      hitBtn.onclick = () => playerHit();
      actionsArea.appendChild(hitBtn);
      // Stand
      let standBtn = document.createElement('button');
      standBtn.textContent = 'Stand';
      standBtn.className = 'stand-btn';
      standBtn.onclick = () => playerStand();
      actionsArea.appendChild(standBtn);
      // Double
      if (canDoubleDown(hand)) {
        let dblBtn = document.createElement('button');
        dblBtn.textContent = 'Double Down';
        dblBtn.className = 'double-btn';
        dblBtn.onclick = () => playerDouble();
        actionsArea.appendChild(dblBtn);
      }
      // Split
      if (canSplitHand(hand)) {
        let splitBtn = document.createElement('button');
        splitBtn.textContent = 'Split';
        splitBtn.className = 'split-btn';
        splitBtn.onclick = () => playerSplit();
        actionsArea.appendChild(splitBtn);
      }
    }

    function getCardSymbol(card) {
      let suitSym = {
        'hearts': '♥',
        'diamonds': '♦',
        'spades': '♠',
        'clubs': '♣'
      }[card.suit];
      return card.name + suitSym;
    }

    function dealCard(toHand, anim = true) {
      if (deck.length < 20) deck = buildDeck();
      let card = deck.pop();
      toHand.push(card);
    }

    // Betting controls
    function enableBetting(val) {
      let chips = document.querySelectorAll('.chip');
      chips.forEach(c => c.style.pointerEvents = val ? 'auto' : 'none');
      clearBetBtn.disabled = !val;
      redoBetBtn.disabled = !val;
      dealBtn.disabled = !val;
    }
    chipsArea.onclick = (e) => {
      if (!e.target.classList.contains('chip') || inPlay || waitingNextHand) return;
      let val = parseInt(e.target.getAttribute('data-value'));
      if (bet + val > playerChips) return;
      bet += val;
      updateBetInfo();
    };
    clearBetBtn.onclick = () => {
      if (inPlay || waitingNextHand) return;
      bet = 0;
      updateBetInfo();
    };
    redoBetBtn.onclick = () => {
      if (inPlay || waitingNextHand) return;
      if (lastBet > 0 && lastBet <= playerChips) {
        bet = lastBet;
        updateBetInfo();
      }
    };
    dealBtn.onclick = () => {
      if (inPlay || bet < 20 || bet > playerChips || waitingNextHand) return;
      startHand();
    };

    // Main gameplay
    function startHand() {
      clearTimeouts();
      inPlay = true;
      playerBlackjack = false;
      dealerBlackjack = false;
      playerHands = [[]];
      currentHandIdx = 0;
      dealerHand = [];
      playerChips -= bet;
      lastBet = bet;
      updateChips();
      updateBetInfo();
      enableBetting(false);
      // Deal initial cards with animation
      renderHands(false, true);
      setTimeout(() => {
        dealCard(playerHands[0]);
        renderHands(false, true);
        animTimeouts.push(setTimeout(() => {
          dealCard(dealerHand);
          renderHands(false, true);
          animTimeouts.push(setTimeout(() => {
            dealCard(playerHands[0]);
            renderHands(false, true);
            animTimeouts.push(setTimeout(() => {
              dealCard(dealerHand);
              renderHands(false, true);
              afterInitialDeal();
            }, 350));
          }, 350));
        }, 350));
      }, 350);
    }

    function afterInitialDeal() {
      canSplit = canSplitHand(playerHands[0]);
      canDouble = canDoubleDown(playerHands[0]);
      playerBlackjack = isBlackjack(playerHands[0]);
      dealerBlackjack = isBlackjack(dealerHand);

      renderHands(false);
      renderActions();

      if (playerBlackjack || dealerBlackjack) {
        setTimeout(() => finishHand(), 700);
      } else {
        statusMsg.textContent = 'Your move!';
      }
    }

    function playerHit() {
      let hand = playerHands[currentHandIdx];
      dealCard(hand);
      renderHands(false, true);
      setTimeout(() => {
        renderHands(false);
        if (handValue(hand) > 21) {
          statusMsg.textContent = 'Busted!';
          setTimeout(() => nextHandOrFinish(), 700);
        } else {
          renderActions();
        }
      }, 350);
    }

    function playerStand() {
      nextHandOrFinish();
    }

    function playerDouble() {
      if (playerChips < bet) return;
      playerChips -= bet;
      updateChips();
      let hand = playerHands[currentHandIdx];
      dealCard(hand);
      renderHands(false, true);
      setTimeout(() => {
        renderHands(false);
        nextHandOrFinish();
      }, 350);
    }

    function playerSplit() {
      if (!canSplitHand(playerHands[currentHandIdx])) return;
      if (playerChips < bet) return;
      playerChips -= bet;
      updateChips();
      let hand = playerHands[currentHandIdx];
      let newHand = [hand.pop()];
      playerHands.push(newHand);
      dealCard(hand);
      dealCard(newHand);
      renderHands(false, true);
      setTimeout(() => {
        renderHands(false);
        renderActions();
      }, 350);
    }

    function nextHandOrFinish() {
      if (currentHandIdx < playerHands.length - 1) {
        currentHandIdx++;
        renderHands(false);
        renderActions();
        statusMsg.textContent = 'Next hand!';
      } else {
        finishHand();
      }
    }

    function finishHand() {
      inPlay = false;
      renderActions();
      // Reveal dealer's hole card
      renderHands(true);
      setTimeout(() => dealerPlay(), 650);
    }

    function dealerPlay() {
      // Dealer hits on soft 17
      while (handValue(dealerHand) < 17 || (handValue(dealerHand) === 17 && hasSoft17(dealerHand))) {
        dealCard(dealerHand);
      }
      renderHands(true, true);
      setTimeout(() => settleBets(), 700);
    }

    function hasSoft17(hand) {
      let total = 0, aces = 0;
      for (const card of hand) {
        total += card.value;
        if (card.name === 'A') aces++;
      }
      return total === 17 && aces > 0;
    }

    function settleBets() {
      let dealerVal = handValue(dealerHand);
      let messages = [];
      let totalWin = 0;
      let winAnim = false;
      for (let i = 0; i < playerHands.length; i++) {
        let hand = playerHands[i];
        let val = handValue(hand);
        let win = 0;
        let msg = '';
        if (isBlackjack(hand)) {
          if (isBlackjack(dealerHand)) {
            win = bet;
            msg = 'Push (Both Blackjack)';
          } else {
            win = bet * 2;
            msg = 'Blackjack! You win 2x!';
            winAnim = true;
          }
        } else if (val > 21) {
          win = 0;
          msg = 'Busted!';
        } else if (dealerVal > 21) {
          win = bet * 2;
          msg = 'Dealer busts! You win!';
          winAnim = true;
        } else if (val > dealerVal) {
          win = bet * 2;
          msg = 'You win!';
          winAnim = true;
        } else if (val === dealerVal) {
          win = bet;
          msg = 'Push!';
        } else {
          win = 0;
          msg = 'You lose!';
        }
        playerChips += win;
        totalWin += win;
        messages.push(`Hand ${playerHands.length > 1 ? (i+1) + ': ' : ''}${msg}`);
      }
      updateChips();
      statusMsg.textContent = messages.join(' | ');
      if (winAnim) {
        playerChipsDiv.classList.add('win-anim');
        setTimeout(() => playerChipsDiv.classList.remove('win-anim'), 2100);
      }
      waitingNextHand = true;
      nextHandBtn.style.display = '';
      enableBetting(false);
    }

    nextHandBtn.onclick = () => {
      if (!waitingNextHand) return;
      resetGame();
    };

    // Init
    deck = buildDeck();
    resetGame();

    // For mobile: prevent double-tap zoom
    document.addEventListener('touchstart', function preventZoom(e) {
      if (e.touches.length > 1) e.preventDefault();
    }, { passive: false });
  </script>
</body>
</html>
